upstream sms_django_server {
         server 127.0.0.1:8000; # 此处为uwsgi运行的ip地址和端口号
     }

upstream websocket_server {
         server 127.0.0.1:8001; # 此处为websocket运行的ip地址和端口号
     }

    server {
    listen 80 default_server;
    listen [::]:80 default_server;
    charset utf-8;
    access_log  /etc/nginx/logs/security_platform.access.log  main;
    error_log  /etc/nginx/logs/security_platform.error.log;

    root /opt/node/gy-v2/;
    index index.html ;

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
             expires 30d;
    }

    location ~ .*\.(js|css)?$ {
             expires 1h;
    }

    location ^~ /static/xadmin {
             access_log off;
             expires 30d;
             alias /home/OPS/sms_compile/front_end_pc/static/xadmin/;
    }

    location ^~ /ws/ {
        proxy_pass http://websocket_server;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $server_name;
    }

    location /xadmin {
             include uwsgi_params;
             uwsgi_pass sms_django_server;
    }

   location / {
            try_files $uri $uri/ @backend;
   }

   location @backend {
            include uwsgi_params;
            uwsgi_pass sms_django_server;
            uwsgi_send_timeout 1000;
            uwsgi_connect_timeout 1000;
            uwsgi_read_timeout 1000;
            add_header backendIP $upstream_addr;
            proxy_set_header       Host $host;
            proxy_set_header User_Agent $http_user_agent;
            proxy_set_header Http_Referer $http_referer;
            proxy_set_header        X-Real-IP $remote_addr;
            proxy_set_header REMOTE-HOST $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_connect_timeout 1000;
            proxy_send_timeout 1000;
            proxy_read_timeout 1000;
   }
}
