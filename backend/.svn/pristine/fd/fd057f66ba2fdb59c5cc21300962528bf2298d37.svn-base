from django.db import models

from security_platform import TextChoices


class SystemConfig(models.Model):
    """用户IP白名单"""

    class ConfigKey(TextChoices):
        SECURITY_SPEED = 'security_speed', '安检速度(单位:人/小时)'
        EVENT_CLOSE = 'event_close', '报警事件自动关闭(单位:小时)'
        EVENT_DELETE = 'event_delete', '报警事件删除(单位:天)'
        ANALYSIS_ALARM = 'analysis_alarm_delete', '视频分析报警(单位:天)'
        SUBSYSTEM_CURRENT = 'subsystem_current_delete', '子系统实时消息(单位:天)'
        ANALYSIS_CURRENT = 'analysis_current_delete', '视频分析实时消息(单位:天)'

    config_key = models.CharField('系统配置名称', unique=True, max_length=50, choices=ConfigKey.choices)
    config_value = models.CharField('系统配置值', max_length=100)
    is_exposed = models.BooleanField('是否暴露给用户', default=True)

    class Meta:
        verbose_name = '系统配置'
        verbose_name_plural = verbose_name
        db_table = 'tb_system_config'

    @classmethod
    def config_data_init(cls):
        # 安检速度，默认30, 单位:人/小时
        cls.objects.get_or_create(config_key=cls.ConfigKey.SECURITY_SPEED, defaults={'config_value': 30})

        # 报警事件删除 默认365天 单位:天
        cls.objects.get_or_create(config_key=cls.ConfigKey.EVENT_DELETE, defaults={'config_value': 365})

        # 报警事件自动关闭(不可生成事件工单) 默认1小时 单位:小时
        cls.objects.get_or_create(config_key=cls.ConfigKey.EVENT_CLOSE, defaults={'config_value': 1})

        # 子系统实时消息删除，航班，道口车辆, 365天
        cls.objects.get_or_create(config_key=cls.ConfigKey.SUBSYSTEM_CURRENT, defaults={'config_value': 365, 'is_exposed': False})

        # 视频分析报警删除 60天
        cls.objects.get_or_create(config_key=cls.ConfigKey.ANALYSIS_ALARM, defaults={'config_value': 60, 'is_exposed': False})

        # 视频分析实时消息删除 60天
        cls.objects.get_or_create(config_key=cls.ConfigKey.ANALYSIS_CURRENT, defaults={'config_value': 60, 'is_exposed': False})

    @property
    def value(self):
        return eval(self.config_value)
